
<div>

  <div ng-switch on="archivedTabName">
    <archived-case-user-filters ng-switch-when="true"> </archived-case-user-filters>
    <active-case-user-filters ng-switch-default> </active-case-user-filters>
  </div>
  <div class="panel panel-default">

    <div class="panel-heading title">{{ 'Case list' | translate }}  <span ng-click="caseUserCtrl.reinitCases()" tooltip="{{ 'Refresh' | translate}}" tooltip-animation="false" tooltip-popup-delay="300" class="case-list-refresh glyphicon glyphicon-repeat"></span></div>
    <div class="panel-body">
        <div ng-show="cases.length">
        <div class="col-md-12 table-responsive">
          <table ng-if="!archivedTabName" bonitable bo-storable="user-cases-list" on-storage-loaded="caseUserCtrl.loadContent()" bo-repeatable repeatable-config="columnSettings" on-sort="caseUserCtrl.updateSortField(sortOptions)" sort-options="sortOptions" resizable-column="$columns" resize-selector="tr th.case-column" class="table table-striped table-hover">
            <thead>
              <tr>
                <th colspan="{{$columns.length+2}}">
                  <div class="pull-right table-buttons">
                    <table-settings class="pull-right" page-size="pagination.itemsPerPage" sizes="pageSizes" columns="$columns" update-page-size="caseUserCtrl.changeItemPerPage(size)"></table-settings>
                    <span  ng-if="pagination.total" id="cases-results-size-top" class="pull-right">{{ '{}-{} of {}' | translate | stringTemplater:[currentFirstResultIndex, currentLastResultIndex, pagination.total]}}</span>
                  </div>
                </th>
              </tr>
              <tr data-headers>
                <th class="text-right case-column" bo-sorter="id" bo-sorter-title-asc="{{'sort by ID ascending' | translate}}" bo-sorter-title-desc="{{'sort by ID descending' | translate}}">{{'ID' | translate}}</th>
                <th class="case-column" bo-sorter="name" bo-sorter-title-asc="{{'sort by Process name ascending' | translate}}" bo-sorter-title-desc="{{'sort by Process name descending' | translate}}">{{'Process name' | translate}}</th>
                <th class="case-column">{{'Version' | translate}}</th>
                <th bo-sorter="startDate" class="case-column" bo-sorter-title-asc="{{'sort by Start date ascending' | translate}}" bo-sorter-title-desc="{{'sort by Start date descending' | translate}}">{{'Start date' | translate}}</th>
                <th class="case-column">{{'Started by' | translate}}</th>
                <th class="text-right case-column">{{'Available tasks' | translate}}</th>
                <th bo-sorter="index1" class="case-column" ><span id="infoPopover" class="glyphicon glyphicon-info-sign" popover="{{'To personalize the display of search keys (and columns in general), use the table settings button on the right. You can search on up to 5 search keys.' | translate}}" popover-trigger="mouseenter"></span> {{'Search Key 1' | translate}}</th>
                <th bo-sorter="index2" class="case-column" >{{'Search Key 2' | translate}}</th>
                <th bo-sorter="index3" class="case-column" >{{'Search Key 3' | translate}}</th>
                <th bo-sorter="index4" class="case-column" >{{'Search Key 4' | translate}}</th>
                <th bo-sorter="index5" class="case-column" >{{'Search Key 5' | translate}}</th>
                <th data-ignore class="text-center">{{'Actions' | translate}}</th>

              </tr>
            </thead>
            <tbody>

            <tr ng-repeat="case in cases" id="caseId-{{::case.id}}" class="case-row" ng-class="{'info' : case.selected}">
              <td class="text-right case-detail">
                  <a id="case-detail-link-{{case.id}}"
                     bonita-href="{ token: 'casemoredetails', id: case.id, prependToken: false }"
                     href="">
                      {{case['ID']}}
                  </a>
              </td>
              <td class="case-detail">{{::case['Process name']}}</td>
              <td class="case-detail">{{::case['Version']}}</td>
              <td class="case-detail">{{::caseUserCtrl.parseAndFormat(case['Start date'])}}</td>
              <td class="case-detail" title="{{'username:' | translate}} {{::case['Started by'] || ('System' | translate)}}">{{::case['Started by fullname'] || ('System' | translate)}}</td>
              <td class="case-detail text-right">
                <a ng-if="case['Available tasks'] > 0"
                   id="task-list-btn-{{::case.id}}"
                   bonita-href="{ token: 'tasklistinguser', case: case.ID, prependToken: false }"
                   tooltip="{{'Show available tasks in task list for case' | translate }} {{::case.id}}"
                   tooltip-popup-delay="500"
                   tooltip-animation="false"
                   tooltip-append-to-body="true"
                   href=""
                   class="open-link">
                  {{::case['Available tasks']}}
                </a>
                <span ng-if="case['Available tasks'] === 0">0</span>
              </td>
              <td class="case-detail"><search-index case="case" index="1"></search-index></td>
              <td class="case-detail"><search-index case="case" index="2"></search-index></td>
              <td class="case-detail"><search-index case="case" index="3"></search-index></td>
              <td class="case-detail"><search-index case="case" index="4"></search-index></td>
              <td class="case-detail"><search-index case="case" index="5"></search-index></td>
              <td class="case-link text-center">
                <a id="case-overview-btn-{{::case.id}}"
                   tooltip="{{'View case overview' | translate }}"
                   tooltip-popup-delay="500" tooltip-animation="false"
                   href=""
                   bonita-href="{ token: 'DisplayCaseForm', name: case.processDefinitionId.name, version: case.processDefinitionId.version, processDefinitionId: case.processDefinitionId.id, id: case.id, prependToken: false }"
                   class="open-link">
                  <span class="glyphicon glyphicon-eye-open"></span>
                </a>
                <a id="task-list-btn-{{::case.id}}"
                   tooltip="{{'Show available tasks in task list for case' | translate }} {{::case.ID}}"
                   tooltip-popup-delay="500"
                   tooltip-animation="false"
                   tooltip-append-to-body="true"
                   bonita-href="{ token: 'tasklistinguser', case: case.ID, prependToken: false, filter: 'todo' }"
                   href=""
                   class="open-link">
                  <span class="glyphicon glyphicon-list"></span>
                </a>
              </td>
            </tr>
            </tbody>
          </table>

          <table ng-if="archivedTabName" bonitable bo-storable="archived-user-cases-list" on-storage-loaded="caseUserCtrl.loadContent()" bo-repeatable repeatable-config="columnSettings" on-sort="caseUserCtrl.updateSortField(sortOptions)" sort-options="sortOptions" resizable-column="$columns" resize-selector="tr th.case-column" class="table table-striped">
            <thead>
              <tr>
                <th colspan="{{$columns.length+2}}">
                  <div class="pull-right table-buttons">
                    <table-settings class="pull-right" page-size="pagination.itemsPerPage" sizes="pageSizes" columns="$columns"  update-page-size="caseUserCtrl.changeItemPerPage(size)"></table-settings>
                       <span ng-if="pagination.total" id="cases-results-size-top" class="pull-right">{{ '{}-{} of {}' | translate | stringTemplater:[currentFirstResultIndex, currentLastResultIndex, pagination.total]}}</span>
                  </div>
                </th>
              </tr>
              <tr data-headers>
                <th class="text-right case-column" bo-sorter="sourceObjectId" bo-sorter-title-asc="{{'sort by ID ascending' | translate}}" bo-sorter-title-desc="{{'sort by ID descending' | translate}}">{{'ID' | translate}}</th>
                <th class="case-column" bo-sorter="name" bo-sorter-title-asc="{{'sort by Process name ascending' | translate}}" bo-sorter-title-desc="{{'sort by Process name descending' | translate}}">{{'Process name' | translate}}</th>
                <th class="case-column">{{'Version' | translate}}</th>
                <th bo-sorter="startDate" class="case-column" bo-sorter-title-asc="{{'sort by Start date ascending' | translate}}" bo-sorter-title-desc="{{'sort by Start date descending' | translate}}">{{'Start date' | translate}}</th>
                <th class="case-column" >{{'Started by' | translate}}</th>
                <th bo-sorter="endDate" class="case-column" bo-sorter-title-asc="{{'sort by End date ascending' | translate}}" bo-sorter-title-desc="{{'sort by End date descending' | translate}}">{{'End date' | translate}}</th>
                <th bo-sorter="index1" class="case-column" ><span id="infoPopover" class="glyphicon glyphicon-info-sign" popover="{{'To personalize the display of search keys (and columns in general), use the table settings button on the right. You can search on up to 5 search keys.' | translate}}" popover-trigger="mouseenter"></span> {{'Search Key 1' | translate}}</th>
                <th bo-sorter="index2" class="case-column" >{{'Search Key 2' | translate}}</th>
                <th bo-sorter="index3" class="case-column" >{{'Search Key 3' | translate}}</th>
                <th bo-sorter="index4" class="case-column" >{{'Search Key 4' | translate}}</th>
                <th bo-sorter="index5" class="case-column" >{{'Search Key 5' | translate}}</th>

                <th data-ignore class="text-center">{{'Actions' | translate}}</th>
              </tr>
            </thead>
            <tbody>
            <tr ng-repeat="case in cases" id="caseId-{{::case.id}}" class="case-row" ng-class="{'info' : case.selected}">
              <td class="case-detail text-right">
                  <a id="case-detail-link-{{case.id}}"
                     bonita-href="{ token: 'archivedcasemoredetails', id: case.id, prependToken: false }"
                     href="">
                      {{case['ID']}}
                  </a>
              </td>
              <td class="case-detail">{{::case['Process name']}}</td>
              <td class="case-detail">{{::case['Version']}}</td>
              <td class="case-detail">{{::caseUserCtrl.parseAndFormat(case['Start date'])}}</td>
              <td class="case-detail" title="{{'username:' | translate}} {{::case['Started by'] || ('System' | translate)}}">{{::case['Started by fullname'] || ('System' | translate)}}</td>
              <td class="case-detail">{{::caseUserCtrl.parseAndFormat(case['End date'])}}</td>
              <td class="case-detail"><search-index case="case" index="1"></search-index></td>
              <td class="case-detail"><search-index case="case" index="2"></search-index></td>
              <td class="case-detail"><search-index case="case" index="3"></search-index></td>
              <td class="case-detail"><search-index case="case" index="4"></search-index></td>
              <td class="case-detail"><search-index case="case" index="5"></search-index></td>
              <td class="case-link text-center">
                <a id="case-overview-btn-{{::case.id}}"
                  tooltip="{{'View case overview' | translate }}"
                  tooltip-popup-delay="500" tooltip-animation="false"
                  bonita-href="{ token: 'DisplayCaseForm', name: case.processDefinitionId.name, version: case.processDefinitionId.version, processDefinitionId: case.processDefinitionId.id, id: case.id, sourceObjectId: case.sourceObjectId, prependToken: false }"
                  href=""
                  class="open-link">
                  <span class="glyphicon glyphicon-eye-open"></span>
                </a>
                <a id="task-list-btn-{{::case.id}}"
                   tooltip="{{'Show available tasks in task list for archived case' | translate }} {{::case.ID}}"
                   tooltip-popup-delay="500"
                   tooltip-animation="false"
                   tooltip-append-to-body="true"
                   bonita-href="{ token: 'tasklistinguser', case: case.ID, prependToken: false, filter: 'done' }"
                   href=""
                   class="open-link">
                  <span class="glyphicon glyphicon-list"></span>
                </a>
              </td>
            </tr>
            </tbody>
          </table>
        </div>
        <div class="col-md-12">
          <div class="pull-right" ng-if="pagination.total">
            <span id="cases-results-size-bottom" class="pull-left">{{ '{}-{} of {}' | translate | stringTemplater:[currentFirstResultIndex, currentLastResultIndex, pagination.total]}}</span>
            <pagination id="cases-results-pages" ng-if="pagination.total > pagination.itemsPerPage" ng-click="caseUserCtrl.searchForCases()" boundary-links="true" total-items="pagination.total" ng-model="pagination.currentPage" items-per-page="pagination.itemsPerPage " previous-text="&lsaquo;" next-text="&rsaquo;" first-text="&laquo;" last-text="&raquo;" max-size="5"></pagination>
           </div>
        </div>
      </div>
      <div ng-show="loading">
        <p class="text-muted"><span class="glyphicon glyphicon-refresh glyphicon-refresh-animate"></span>&nbsp;{{ 'Loading...' | translate}}</p>
      </div>
      <div ng-show="!loading &amp;&amp; cases &amp;&amp; cases.length===0">
        <p class="text-muted animated fadeIn">{{ 'No cases to display' | translate }}</p>
      </div>
    </div>
  </div>
</div>
